<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <title>模型库管理</title>
   <!-- <link rel="stylesheet" href="css/threeTwo.css" type="text/css"/>-->
    <link rel="stylesheet" type="text/css" th:href="@{/h-ui/css/H-ui.min.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/h-ui.admin/css/H-ui.admin.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/lib/Hui-iconfont/1.0.8/iconfont.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/h-ui.admin/skin/default/skin.css}" id="skin" />
    <link rel="stylesheet" type="text/css" th:href="@{/h-ui.admin/css/style.css}" />

    <link rel="stylesheet" href="/css/codemirror.css" type="text/css">
    <link rel="stylesheet" href="/css/editcss.css" type="text/css">
    <link rel="stylesheet" href="/css/fullscreen.css" type="text/css">
    <link rel="stylesheet" href="/css/monokai.css" type="text/css">
    <link rel="stylesheet" href="/css/show-hint.css" type="text/css">
    <link rel="stylesheet" href="/css/uploadAlgorithm.css" type="text/css">
    <link rel="stylesheet" href="/css/lint.css" type="text/css">
    <link rel="stylesheet" href="/css/foldgutter.css"  type="text/css">


    <script src="/js/jquery.min.js" type="text/javascript"></script>
    <script src="/js/bootstrap.js" type="text/javascript"></script>
    <script src="/js/codemirror.js" type="text/javascript"></script>
    <script src="/js/javascript.js" type="text/javascript"></script>
    <script src="/js/active-line.js" type="text/javascript"></script>
    <script src="/js/anyword-hint.js" type="text/javascript"></script>
    <script src="/js/fullscreen.js" type="text/javascript"></script>
    <script src="/js/matchbrackets.js" type="text/javascript"></script>
    <script src="/js/python.js" type="text/javascript"></script>
    <script src="/js/r.js" type="text/javascript"></script>
    <script src="/js/show-hint.js" type="text/javascript"></script>


</head>
<body>

<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i>  <span class="c-gray en"></span> 算法库<span class="c-gray en">&gt;</span> 算法在线编辑  <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新" ><i class="Hui-iconfont">&#xe68f;</i></a></nav>
<div class="page-container" style="margin-top: -2%" >

    <input class="btn btn-primary radius" type="button" style="    position: absolute; margin-top: 42%;right: 7%; z-index: 100;"  value="保存" onclick="jumpDialog()" />

    <div class="container-fluid row allBorder">

    <div class="col-sm-8 col-lg-8 col-md-8 leftBorder" id="workSpace1">
        <!--<ul id="myTab" class="nav nav-tabs" role="tablist">-->
            <!--<li class="active" >-->
                <!--<a href="#codePython" role="tab" data-toggle="tab" id="pythonA">-->
                    <!--Python-->
                <!--</a>-->
            <!--</li>-->
            <!--<li >-->
                <!--<a href="#codeR" role="tab" data-toggle="tab" id="rA">-->
                    <!--R语言-->
                <!--</a>-->
            <!--</li>-->
        <!--</ul>-->
        <div id="myTabContent" class="tab-content" style="margin-top: 7%">
            <div class="tab-pane active" id="codePython" >
                    <input type="hidden" name="_method" value="put">
                    <div class="form-group formLine2Border" style="margin-left: 7%;">
                        <textarea class="form-control formLine2TextareaBorder "  rows="35" cols="20" id="pythonInput" name="codeContent"></textarea>
                    </div>





            </div>
            <div class="tab-pane" id="codeR">

            </div>
        </div>
    </div>

    <!--<div class="col-sm-4 col-lg-4 col-md-4 rightBorder" id="workSpace2">-->
        <!--<div class="leftBorder2_top" style="margin-left: -100%;">-->
            <!--<span class="leftBorder2_top_text">代码模板:</span>-->
            <!--<span class="leftBorder2_top_option">-->
                <!--<select id="selectCollection" class="input-text radius size-S" style=" margin-left: 11%;margin-top: 1.5%;font-size: 15px"  onchange="moban()" >-->
                    <!--<option value="" disabled selected hidden>请选择代码模板</option>-->
                    <!--&lt;!&ndash;<option value="模板一" >模板一</option>&ndash;&gt;-->
                    <!--</select>-->
            <!--</span>-->
        <!--</div>-->
        <!--&lt;!&ndash;<div class="leftBorder2_mid">&ndash;&gt;-->
            <!--&lt;!&ndash;<span class="leftBorder2_mid_text">程序输入:</span>&ndash;&gt;-->
            <!--&lt;!&ndash;<textarea id="inputarea" class="inputarea"></textarea>&ndash;&gt;-->
            <!--&lt;!&ndash;<span class="leftBorder2_mid_button">&ndash;&gt;-->
             	<!--&lt;!&ndash;<button type="button" class="btn btn-default">运行</button>&ndash;&gt;-->
            <!--&lt;!&ndash;</span>&ndash;&gt;-->
        <!--&lt;!&ndash;</div>&ndash;&gt;-->
        <!--&lt;!&ndash;<div class="leftBorder2_but">&ndash;&gt;-->
            <!--&lt;!&ndash;<span class="leftBorder2_but_text">结果输出:</span>&ndash;&gt;-->
            <!--&lt;!&ndash;<textarea id="outputarea" class="outputarea"></textarea>&ndash;&gt;-->
            <!--&lt;!&ndash;<span class="leftBorder2_but_button">&ndash;&gt;-->
             	<!--&lt;!&ndash;<button type="button" class="btn btn-default">返回</button>&ndash;&gt;-->
            <!--&lt;!&ndash;</span>&ndash;&gt;-->

        <!--&lt;!&ndash;</div>&ndash;&gt;-->
    <!--</div>-->
    </div>
</div>


<div id="saveUpfile" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <!-- 弹出对话框 -->
    <div class="modal-dialog">
        <div class="modal-content radius">
            <div class="modal-header">
                <h3 class="modal-title">算法保存</h3>
                <a class="close" data-dismiss="modal" aria-hidden="true">×</a>
            </div>
            <div class="modal-body">
                <div class="upfile-group">
                    <!--通过onsubmit 去进行提交前其他操作-->
                    <form  id="form1" onsubmit="return false" action="##" method="post">

                        <div class="modal-body">
                            <strong style="margin-left: 5%">算法名称：</strong><input type="text" name="pythonName" placeholder="请输入算法名称" class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" id="pythonName">
                        </div>


                        <div class="modal-body">
                            <strong style="margin-left: 5%">类&nbsp;&nbsp;&nbsp;&nbsp;别：</strong>
                            <select class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" name="algorithmtype" id="algorithmtype">
                                <option style="font-size: 12px"  value="请选择算法类别">请选择算法类别</option>
                                <option style="font-size: 12px" value="预处理" >预处理</option>
                                <option style="font-size: 12px" value="特征工程">特征工程</option>
                                <option style="font-size: 12px" value="模型训练">模型训练</option>
                                <option style="font-size: 12px" value="模型验证">模型验证</option>
                            </select>
                        </div>



                        <div class="modal-body">
                            <strong style="margin-left: 5%">描&nbsp;&nbsp;&nbsp;&nbsp;述</strong><input type="text" placeholder="请输入算法描述" class="input-text radius size-S" style="margin:10px 15px 10px 27px;;width: 43%;" id="algorithmdescribe" name="algorithmdescribe">
                        </div>



                        <div class="modal-body" ><strong style="margin-left: 5%">标&nbsp;&nbsp;&nbsp;&nbsp;签：</strong>
                            <!--<input type="text" placeholder="请输入对象属性" class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" id="objectattribute">-->
                            <select class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" name="algorithmlabel" id="algorithmlabel" >
                                <option style="font-size: 12px"  value="请选择算法类型">请选择算法类型</option>
                                <option style="font-size: 12px" value="行业通用">行业通用</option>
                                <option style="font-size: 12px" value="行业专用">行业专用</option>
                                <option style="font-size: 12px" value="人工智能">人工智能</option>
                            </select>
                        </div>



                        <div class="modal-body" ><strong style="margin-left: 5%">版&nbsp;&nbsp;&nbsp;&nbsp;本：</strong>
                            <!--<input type="text" placeholder="请输入对象属性" class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" id="objectattribute">-->
                            <select class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" name="algorithmversion" id="algorithmversion">
                                <option style="font-size: 12px" value="请选择算法版本">请选择算法版本</option>
                                <option style="font-size: 12px" value="spark">spark</option>
                                <option style="font-size: 12px" value="python">python</option>
                            </select>
                        </div>

                        <div class="modal-body">
                            <strong style="margin-left: 5%">数据源参数：</strong>
                            <input type="text" placeholder="请输入数据源参数,以分号进行隔开" class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" name="algorithmparamsinput" id="algorithmparamsinput">
                        </div>
                        <div class="modal-body">
                            <strong style="margin-left: 5%">算法参数：</strong>
                            <input type="text" placeholder="请输入算法参数,以分号进行隔开" class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" name="algorithmparamscontent" id="algorithmparamscontent">
                        </div>
                        <div class="modal-body">
                            <strong style="margin-left: 5%">输出参数：</strong>
                            <input type="text" placeholder="请输出参数,以分号进行隔开" class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;" name="algorithmparamsoutput" id="algorithmparamsoutput">
                        </div>

                        <div class="modal-body">
                            <strong style="margin-left: 5%;position: absolute ">算法说明：</strong>
                            <textarea name="textarea" id="textarea" style="border: 1px solid #DDDDDD;margin-left: 20%;width: 46%;height: 7vh;"></textarea>
                            <input type="text" placeholder="请输出算法描述" class="input-text radius size-S" style="margin:10px 15px 10px 15px;;width: 43%;display: none" name="algorithmmiaoshu"  id="algorithmmiaoshu">
                        </div>

                        <div class="button_position">
                            <input type="submit" class="btn btn-primary radius" value="提交" style="margin-left: 80%; margin-top: 0%;" onclick="savemodel()">
                            <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
                        </div>
                    </form><br/>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript" th:inline="javascript">

    function hideDialog() {
        setTimeout($("#saveUpfile").modal("hide"),"3000");
    }

    function savemodel() {
        var content = pythonEditor.getValue();
        var pythonName =  $("input[id='pythonName']").val();

        var  myselect=document.getElementById("algorithmtype");
        var index=myselect.selectedIndex;
        var  algorithmtype = myselect.options[index].value;

        var algorithmdescribe =  $("input[id='algorithmdescribe']").val();

        var  myselect =document.getElementById("algorithmlabel");
        var index=myselect.selectedIndex;
        var  algorithmlabel = myselect.options[index].value;

        var  myselect =document.getElementById("algorithmversion");
        var index=myselect.selectedIndex;
        var  algorithmversion = myselect.options[index].value;

        var algorithmparamsinput =  $("input[id='algorithmparamsinput']").val();
        var algorithmparamscontent =  $("input[id='algorithmparamscontent']").val();
        var algorithmparamsoutput =  $("input[id='algorithmparamsoutput']").val();
        var algorithmmiaoshu =$("#textarea").val();
        // var algorithmmiaoshu =  $("input[id='algorithmmiaoshu']").val();


        $.ajax({
            async: true,
            cache: false,
            url: "/algorithm/saveCodeControllerx",
            type: 'POST',
            data: {
                algorithmmiaoshu:algorithmmiaoshu,
                algorithmversion:algorithmversion,
                algorithmparamsoutput:algorithmparamsoutput,
                algorithmparamscontent:algorithmparamscontent,
                algorithmparamsinput:algorithmparamsinput,
                algorithmlabel:algorithmlabel,
                algorithmdescribe:algorithmdescribe,
                algorithmtype:algorithmtype,
                name: pythonName,
                type: ".py",
                content: content
            },
            success: function () {

                $.Huimodalalert('保存成功', 1000);
                hideDialog();
            },
            error: function () {
                $.Huimodalalert('保存失败', 1000);
            }
        })

    }

</script>





    <script type="text/javascript" th:inline="javascript">

        CodeMirror.commands.autocomplete = function(cm) {
            cm.showHint({hint: CodeMirror.hint.anyword});
        }
        var pythonEditor = CodeMirror.fromTextArea(document.getElementById("pythonInput"), {
            mode: {name: "python",
                version: 3,
                singleLineStringErrors: false},
            matchBrackets: true,
            lineNumbers: true,     // 显示行数
            indentUnit: 4,         // 缩进单位为4
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                "F11": function(cm) {
                    cm.setOption("fullScreen", !cm.getOption("fullScreen"));
                },
                "Esc": function(cm) {
                    if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
                }
            },//自动补全
            styleActiveLine: true, // 当前行背景高亮
            theme: 'monokai',      // 使用monokai模版
        });

        pythonEditor.setOption("extraKeys", {
            // Tab键换成4个空格
            Tab: function(cm) {
                var spaces = Array(cm.getOption("indentUnit") + 1).join(" ");
                cm.replaceSelection(spaces);
            },
            // F11键切换全屏
            "F11": function(cm) {
                cm.setOption("fullScreen", !cm.getOption("fullScreen"));
            },
            // Esc键退出全屏
            "Esc": function(cm) {
                if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
            }
        });

        function jumpDialog() {
            $("#saveUpfile").modal("show");
        }

        function pythonSave() {
            var content = pythonEditor.getValue();

            $.ajax({
                async: true,
                cache: false,
                url: "/algorithm/saveCodeController",
                type: 'POST',
                data: {
                    name: $("#pythonName").val(),
                    type: ".py",
                    content: content
                },
                success: function () {
                    $.Huimodalalert('保存成功', 1000);
                },
                error: function () {
                    $.Huimodalalert('保存失败', 1000);
                }
            })
        }
        // function moban() {
        //
        //     var algorithmJsonString = [[${algorithmJsonString}]];
        //     var algorithmJson = eval('('+algorithmJsonString+')');
        //     var length = Object.keys(algorithmJson).length;
        //     var textarea = document.getElementById('pythonInput');
        //     var algorithmArray = new Array();
        //     // algorithmArray.push("<pre>");
        //     for (var i = 0; i < length; i++ ){
        //         // $("#textarea").val(algorithmJson[''+i+''])  ;
        //         algorithmArray.push(algorithmJson[''+i+'']);
        //
        //     }
        //     // algorithmArray.push("</pre>");
        //     pythonEditor.setValue(algorithmArray.join("\n"));
        // }
    </script>

    <script type="text/javascript" th:inline="javascript">
        window.onload=function() {
            var algorithmJsonString = [[${algorithmJsonString}]];
            var algorithmJson = eval('('+algorithmJsonString+')');
            var length = Object.keys(algorithmJson).length;
            var textarea = document.getElementById('pythonInput');
            var algorithmArray = new Array();
            // algorithmArray.push("<pre>");
            for (var i = 0; i < length; i++ ){
                // $("#textarea").val(algorithmJson[''+i+''])  ;
                algorithmArray.push(algorithmJson[''+i+'']);

            }
            // algorithmArray.push("</pre>");
            pythonEditor.setValue(algorithmArray.join("\n"));
        }
    </script>


<script type="text/javascript" th:src="@{/lib/jquery/1.9.1/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/lib/layer/2.4/layer.js}"></script>
<script type="text/javascript" th:src="@{/h-ui/js/H-ui.min.js}"></script>
<script type="text/javascript" th:src="@{/h-ui.admin/js/H-ui.admin.js}"></script>
<!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" th:src="@{lib/My97DatePicker/4.8/WdatePicker.js}"></script>
<script type="text/javascript" th:src="@{lib/datatables/1.10.0/jquery.dataTables.min.js}"></script>
<script type="text/javascript" th:src="@{lib/laypage/1.2/laypage.js}"></script>
<script type="text/javascript" th:inline="javascript">

</script>
</body>
</html>

